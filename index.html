<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Involution Network - Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #bbb; margin-bottom: 40px; }
        .modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .module-btn {
            padding: 20px;
            background: #2a2a3e;
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .module-btn:hover { background: #3a3a4e; transform: translateY(-2px); }
        .module-btn.active { background: #4a90e2; box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4); }
        .content-area {
            background: #2a2a3e;
            border-radius: 15px;
            padding: 30px;
            min-height: 500px;
        }
        .content-title { font-size: 1.8rem; margin-bottom: 10px; }
        .content-desc { color: #aaa; margin-bottom: 30px; line-height: 1.6; }
        canvas { max-width: 100%; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: #1a1a2e;
            padding: 20px;
            border-radius: 10px;
        }
        .stat-label { color: #888; font-size: 0.9rem; margin-bottom: 8px; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #4a90e2; }
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            margin: 20px 0;
            max-width: 400px;
        }
        .matrix-cell {
            aspect-ratio: 1;
            border-radius: 2px;
        }
        .steps {
            margin-top: 20px;
        }
        .step-item {
            background: #1a1a2e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
        }
        .step-num {
            width: 35px;
            height: 35px;
            background: #4a90e2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .footer { text-align: center; margin-top: 40px; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Graph Involution Network Architecture</h1>
        <p class="subtitle">Interactive Module Visualization</p>
        
        <div class="modules">
            <button class="module-btn active" onclick="showModule('efficientnet')">EfficientNet-B3</button>
            <button class="module-btn" onclick="showModule('graph')">Graph Construction</button>
            <button class="module-btn" onclick="showModule('involution')">Involution Layers</button>
            <button class="module-btn" onclick="showModule('aggregation')">Feature Aggregation</button>
            <button class="module-btn" onclick="showModule('architecture')">Full Architecture</button>
            <button class="module-btn" onclick="showModule('attention')">Attention</button>
        </div>

        <div class="content-area" id="content">
            <!-- Content will be dynamically inserted here -->
        </div>

        <div class="footer">
            <p>Interactive visualization of Graph Involution Network for cervical cancer classification</p>
            <p style="margin-top: 10px;">Dataset: 5 classes (Dyskeratotic, Koilocytotic, Metaplastic, Parabasal, Superficial-Intermediate)</p>
        </div>
    </div>

    <script>
        let currentChart = null;

        function showModule(module) {
            // Update button states
            document.querySelectorAll('.module-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Destroy previous chart
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }

            const content = document.getElementById('content');

            switch(module) {
                case 'efficientnet':
                    content.innerHTML = `
                        <h2 class="content-title">EfficientNet-B3 Feature Extraction</h2>
                        <p class="content-desc">Progressive feature dimensionality reduction from 240×240×3 input to 1536-dimensional feature vector</p>
                        <canvas id="chart"></canvas>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Input Dimensions</div>
                                <div class="stat-value">240 × 240 × 3</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Output Features</div>
                                <div class="stat-value">1536-D</div>
                            </div>
                        </div>
                    `;
                    drawEfficientNet();
                    break;

                case 'graph':
                    content.innerHTML = `
                        <h2 class="content-title">Adaptive Graph Construction</h2>
                        <p class="content-desc">Cosine similarity matrix with adaptive thresholding (μ + 0.5σ) to create graph adjacency</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h3 style="margin-bottom: 15px;">Similarity Matrix (10×10)</h3>
                                <div class="matrix-grid" id="matrix"></div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888; margin-top: 10px;">
                                    <span>Low Similarity</span>
                                    <span>High Similarity</span>
                                </div>
                            </div>
                            <div>
                                <h3 style="margin-bottom: 15px;">Node Connectivity</h3>
                                <canvas id="chart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card" style="margin-top: 20px;">
                            <strong style="color: #4a90e2;">Formula:</strong> Adjacency[i,j] = 1 if cosine_similarity(i,j) > (μ + 0.5σ), else 0
                        </div>
                    `;
                    drawGraphConstruction();
                    break;

                case 'involution':
                    content.innerHTML = `
                        <h2 class="content-title">Graph Involution Layers (GIN)</h2>
                        <p class="content-desc">Location-specific kernel generation with group-wise feature processing</p>
                        <canvas id="chart"></canvas>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Kernel Size (k)</div>
                                <div class="stat-value">7 neighbors</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total GIN Layers</div>
                                <div class="stat-value">3 layers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Group Config</div>
                                <div class="stat-value">4-4-2</div>
                            </div>
                        </div>
                    `;
                    drawInvolution();
                    break;

                case 'aggregation':
                    content.innerHTML = `
                        <h2 class="content-title">Feature Aggregation Pipeline</h2>
                        <p class="content-desc">Multi-step aggregation: kernel generation → neighbor selection → weighted fusion</p>
                        <canvas id="chart"></canvas>
                        <div class="steps">
                            <div class="step-item">
                                <div class="step-num">1</div>
                                <div>
                                    <strong>Node Feature Input</strong><br>
                                    <span style="color: #888;">Extract features from current node</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">2</div>
                                <div>
                                    <strong>Dynamic Kernel Generation</strong><br>
                                    <span style="color: #888;">Generate location-specific attention weights</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">3</div>
                                <div>
                                    <strong>Neighbor Selection (Top-k)</strong><br>
                                    <span style="color: #888;">Select k=7 most similar neighbors from graph</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-num">4</div>
                                <div>
                                    <strong>Weighted Aggregation</strong><br>
                                    <span style="color: #888;">Apply involution kernels to neighbor features</span>
                                </div>
                            </div>
                        </div>
                    `;
                    drawAggregation();
                    break;

                case 'architecture':
                    content.innerHTML = `
                        <h2 class="content-title">Complete Network Architecture</h2>
                        <p class="content-desc">End-to-end feature transformation from input image to 5-class classification</p>
                        <canvas id="chart"></canvas>
                        <div class="stat-card" style="margin-top: 20px; padding: 25px;">
                            <h3 style="margin-bottom: 20px;">Architecture Flow</h3>
                            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; font-size: 0.9rem;">
                                <div style="text-align: center;">
                                    <div style="background: #3B82F6; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">Input</div>
                                    <span style="color: #888;">240×240×3</span>
                                </div>
                                <span style="color: #666;">→</span>
                                <div style="text-align: center;">
                                    <div style="background: #3B82F6; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">EfficientNet</div>
                                    <span style="color: #888;">1536-D</span>
                                </div>
                                <span style="color: #666;">→</span>
                                <div style="text-align: center;">
                                    <div style="background: #8B5CF6; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">GIN-1</div>
                                    <span style="color: #888;">512-D</span>
                                </div>
                                <span style="color: #666;">→</span>
                                <div style="text-align: center;">
                                    <div style="background: #8B5CF6; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">GIN-2</div>
                                    <span style="color: #888;">256-D</span>
                                </div>
                                <span style="color: #666;">→</span>
                                <div style="text-align: center;">
                                    <div style="background: #8B5CF6; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">GIN-3</div>
                                    <span style="color: #888;">128-D</span>
                                </div>
                                <span style="color: #666;">→</span>
                                <div style="text-align: center;">
                                    <div style="background: #EF4444; padding: 10px 15px; border-radius: 5px; margin-bottom: 5px;">Output</div>
                                    <span style="color: #888;">5 classes</span>
                                </div>
                            </div>
                        </div>
                    `;
                    drawArchitecture();
                    break;

                case 'attention':
                    content.innerHTML = `
                        <h2 class="content-title">Attention Mechanism</h2>
                        <p class="content-desc">Dynamic attention weights for global feature pooling and sample importance</p>
                        <canvas id="chart"></canvas>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">High Attention</div>
                                <div style="display: flex; align-items: center; margin-top: 10px;">
                                    <div style="width: 20px; height: 20px; background: #EAB308; border-radius: 3px; margin-right: 10px;"></div>
                                    <span style="color: #fff; font-weight: bold;">> 0.6</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Medium Attention</div>
                                <div style="display: flex; align-items: center; margin-top: 10px;">
                                    <div style="width: 20px; height: 20px; background: #F59E0B; border-radius: 3px; margin-right: 10px;"></div>
                                    <span style="color: #fff; font-weight: bold;">0.4 - 0.6</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Low Attention</div>
                                <div style="display: flex; align-items: center; margin-top: 10px;">
                                    <div style="width: 20px; height: 20px; background: #EF4444; border-radius: 3px; margin-right: 10px;"></div>
                                    <span style="color: #fff; font-weight: bold;">< 0.4</span>
                                </div>
                            </div>
                        </div>
                    `;
                    drawAttention();
                    break;
            }
        }

        function drawEfficientNet() {
            const ctx = document.getElementById('chart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Input', 'Block 1', 'Block 2', 'Block 3', 'Block 4', 'Block 5', 'GAP', 'Refined'],
                    datasets: [{
                        label: 'Feature Dimensions',
                        data: [172800, 576000, 288000, 172800, 86400, 98304, 1536, 1536],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    },
                    scales: {
                        y: { ticks: { color: '#888' }, grid: { color: '#333' } },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function drawGraphConstruction() {
            // Draw similarity matrix
            const matrix = document.getElementById('matrix');
            for (let i = 0; i < 10; i++) {
                for (let j = 0; j < 10; j++) {
                    const sim = i === j ? 1.0 : Math.max(0, 1 - Math.abs(i - j) * 0.15 + (Math.random() - 0.5) * 0.3);
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    const intensity = Math.floor(sim * 255);
                    cell.style.backgroundColor = `rgb(${255 - intensity}, 100, ${intensity})`;
                    matrix.appendChild(cell);
                }
            }

            // Draw bar chart
            const ctx = document.getElementById('chart').getContext('2d');
            const degrees = Array.from({length: 10}, () => Math.floor(Math.random() * 6) + 2);
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
                    datasets: [{
                        label: 'Node Degree',
                        data: degrees,
                        backgroundColor: '#10B981'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { ticks: { color: '#888' }, grid: { color: '#333' } },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function drawInvolution() {
            const ctx = document.getElementById('chart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Input', 'GIN-1', 'GIN-2', 'GIN-3'],
                    datasets: [
                        {
                            label: 'Output Dimensions',
                            data: [1536, 512, 256, 128],
                            backgroundColor: '#8B5CF6'
                        },
                        {
                            label: 'Groups',
                            data: [4, 4, 4, 2],
                            backgroundColor: '#A78BFA'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { ticks: { color: '#888' }, grid: { color: '#333' } },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function drawAggregation() {
            const ctx = document.getElementById('chart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Node Features', 'Kernel Gen', 'Neighbor Select', 'Weighted Agg', 'Group Fusion', 'Output'],
                    datasets: [{
                        label: 'Relative Activation',
                        data: [100, 85, 70, 55, 40, 100],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { ticks: { color: '#888' }, grid: { color: '#333' } },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function drawArchitecture() {
            const ctx = document.getElementById('chart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Extractor', 'GIN-1', 'GIN-2', 'GIN-3', 'Classifier', 'Output'],
                    datasets: [{
                        label: 'Feature Dimensions (log scale)',
                        data: [1536, 512, 256, 128, 64, 5],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { 
                            type: 'logarithmic',
                            ticks: { color: '#888' }, 
                            grid: { color: '#333' } 
                        },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        function drawAttention() {
            const ctx = document.getElementById('chart').getContext('2d');
            const weights = Array.from({length: 16}, () => Math.random() * 0.8 + 0.2);
            const colors = weights.map(w => w > 0.6 ? '#EAB308' : w > 0.4 ? '#F59E0B' : '#EF4444');
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 16}, (_, i) => i + 1),
                    datasets: [{
                        label: 'Attention Weight',
                        data: weights,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { 
                            ticks: { color: '#888' }, 
                            grid: { color: '#333' },
                            max: 1
                        },
                        x: { ticks: { color: '#888' }, grid: { color: '#333' } }
                    }
                }
            });
        }

        // Initialize with first module
        showModule('efficientnet');
    </script>
</body>
</html>
